# DeepBook Margin State Time Series Output

Position B (0xbcb8ee0447179ea67787dfca1d4d0c54ff82ffe6) - 8 Daily Snapshots

## Return Value Schema (from `manager_state` function)

Based on `main.rs` documentation, the `manager_state<B, Q>` function returns 14 values:

| Index | Field | Type | Description |
|-------|-------|------|-------------|
| 0 | manager_id | address | Margin manager object ID |
| 1 | deepbook_pool_id | address | Associated DeepBook pool |
| 2 | risk_ratio | u64 | Health factor (assets/debt), scaled by 1e9 |
| 3 | base_asset | u64 | Base asset balance with locked (MIST) |
| 4 | quote_asset | u64 | Quote asset balance (scaled by 1e6) |
| 5 | base_debt | u64 | Borrowed base amount (MIST) |
| 6 | quote_debt | u64 | Borrowed quote amount (scaled by 1e6) |
| 7 | base_pyth_price | u64 | Pyth oracle price for base asset |
| 8 | base_pyth_decimals | u64 | Base price decimals |
| 9 | quote_pyth_price | u64 | Pyth oracle price for quote asset |
| 10 | quote_pyth_decimals | u64 | Quote price decimals |
| 11 | current_price | u64 | Calculated base/quote price (scaled by 1e9) |
| 12 | lowest_trigger_above | u64 | TP/SL trigger for longs |
| 13 | highest_trigger_below | u64 | TP/SL trigger for shorts |

## Time Series Summary

| Day | Checkpoint | Risk % | SUI Balance | SUI Debt | USDC Balance | USDC Debt | Current Price | Status |
|-----|------------|--------|-------------|----------|--------------|-----------|---------------|--------|
| 1 | 235510810 | 100000.00% | 0.0914 | 0.0000 | 0.96 | 0.00 | 0.001802 | âœ… |
| 2 | 235859237 | 100000.00% | 0.0914 | 0.0000 | 0.96 | 0.00 | 0.001773 | âœ… |
| 3 | 236134228 | 100000.00% | 0.0914 | 0.0000 | 0.96 | 0.00 | 0.001571 | âœ… |
| 4 | 236289445 | 34.87% | 0.0914 | 2.0002 | 0.96 | 0.00 | 0.001578 | âœ… |
| 5 | 236527001 | 11.10% | 0.0914 | 6.5336 | 0.96 | 0.00 | 0.001510 | âœ… |
| 6 | 236926043 | 100000.00% | 0.0914 | 0.0000 | 0.96 | 0.00 | 0.001478 | âœ… |
| 7 | 237137954 | 23.36% | 0.0914 | 3.0667 | 0.96 | 0.00 | 0.001531 | âœ… |
| 8 | 237335780 | 100000.00% | 0.0914 | 0.0000 | 0.96 | 0.00 | 0.001493 | âœ… |

**Success Rate: 8/8 (100%)**

## Interpretation

### Risk Ratio
- **100000.00%** = No debt / fully collateralized (the position has no borrowed assets)
- **Lower values** (11-35%) = Active borrowing, calculated as `collateral_value / debt_value * 100`

### Position Activity Timeline
1. **Days 1-3**: Position created, no active borrowing
2. **Day 4**: First borrow of ~2 SUI, risk ratio drops to 34.87%
3. **Day 5**: Increased borrowing to ~6.5 SUI, risk ratio at 11.10% (most leveraged)
4. **Day 6**: Position fully repaid, back to 100000%
5. **Day 7**: New borrow of ~3 SUI, risk ratio at 23.36%
6. **Day 8**: Position fully repaid again

### Price Movement
- SUI/USDC price ranged from 0.001493 to 0.001802 over the 8-day period
- Base Pyth prices confirm this (e.g., 180169228 scaled â†’ $1.80 for SUI)

## Raw Output

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     DeepBook Margin State Time Series Example (Position B)          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Demonstrates historical time series tracking:                       â•‘
â•‘    â€¢ 8 consecutive daily snapshots                                   â•‘
â•‘    â€¢ Position evolution tracking                                     â•‘
â•‘    â€¢ Day-over-day margin health analysis                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ğŸ“‚ Loading time series from: ./examples/deepbook_margin_state/data/position_b_daily_timeseries.json
  âœ“ Daily time series for SUI/USDC margin position B (0xbcb8ee...)
  ğŸ“Š Pool: SUI/USDC | Snapshots: 8
  ğŸ“ Margin Manager: 0xbcb8ee0447179ea677...
  ğŸ• Position created at checkpoint: 235510810

Day 1 (Checkpoint 235510810):
  Risk Ratio: 100000.00% (no debt)
  SUI Balance: 0.0914 | SUI Debt: 0.0000
  USDC Balance: 0.96 | USDC Debt: 0.00
  Current Price: 0.001802
  Base Pyth Price: 180169228 | Quote Pyth Price: 99978558

Day 4 (Checkpoint 236289445):
  Risk Ratio: 34.87% (borrowing active)
  SUI Balance: 0.0914 | SUI Debt: 2.0002
  USDC Balance: 0.96 | USDC Debt: 0.00
  Current Price: 0.001578
  Base Pyth Price: 157796062 | Quote Pyth Price: 99975854

Day 5 (Checkpoint 236527001):
  Risk Ratio: 11.10% (maximum leverage this period)
  SUI Balance: 0.0914 | SUI Debt: 6.5336
  USDC Balance: 0.96 | USDC Debt: 0.00
  Current Price: 0.001510
  Base Pyth Price: 150933888 | Quote Pyth Price: 99974215
```

## Generated

This output was generated by running:
```bash
cargo run --example deepbook_timeseries
```

The time series data is stored in `position_b_daily_timeseries.json`.
